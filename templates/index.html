<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ham Radio Conditions</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .condition-good { color: #10B981; }
        .condition-fair { color: #F59E0B; }
        .condition-poor { color: #EF4444; }
        
        /* Icon colors and animations */
        .icon-solar { color: #F59E0B; }
        .icon-band { color: #3B82F6; }
        .icon-weather { color: #10B981; }
        .icon-dxcc { color: #8B5CF6; }
        .icon-spots { color: #EC4899; }
        .icon-propagation { color: #8B5CF6; }
        
        .section-icon {
            transition: transform 0.2s ease-in-out;
        }
        .section-icon:hover {
            transform: scale(1.1);
        }

        /* Loading animation */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #EC4899;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Add to existing styles */
        .propagation-excellent { color: #10B981; }
        .propagation-good { color: #3B82F6; }
        .propagation-fair { color: #F59E0B; }
        .propagation-poor { color: #EF4444; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Hidden data element -->
    <script id="data" type="application/json">
        {{ data|tojson|safe }}
    </script>

    <!-- Hidden element for initial data -->
    <script id="initial-data" type="application/json">
        {{ data|tojson|safe }}
    </script>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">Ham Radio Conditions</h1>
            <p class="text-gray-400" id="timestamp"></p>
            <p class="text-gray-400" id="location"></p>
        </header>

        <!-- Error Message -->
        <div id="error-message" class="bg-red-500 text-white p-4 rounded-lg mb-4" style="display: none;"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Weather Conditions -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-cloud mr-2 section-icon icon-weather"></i>Weather Conditions
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Temperature</div>
                            <div class="text-xl font-semibold" id="temperature">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Humidity</div>
                            <div class="text-xl font-semibold" id="humidity">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Pressure</div>
                            <div class="text-xl font-semibold" id="pressure">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Description</div>
                            <div class="text-xl font-semibold" id="description">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">City</div>
                            <div class="text-xl font-semibold" id="city">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">State</div>
                            <div class="text-xl font-semibold" id="state">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Solar Conditions -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-sun mr-2 section-icon icon-solar"></i>Solar Conditions
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">SFI</div>
                            <div class="text-xl font-semibold" id="sfi">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">A-Index</div>
                            <div class="text-xl font-semibold" id="a-index">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">K-Index</div>
                            <div class="text-xl font-semibold" id="k-index">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Aurora</div>
                            <div class="text-xl font-semibold" id="aurora">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">X-Ray</div>
                            <div class="text-xl font-semibold" id="xray">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Sunspots</div>
                            <div class="text-xl font-semibold" id="sunspots">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Proton Flux</div>
                            <div class="text-xl font-semibold" id="proton-flux">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Electron Flux</div>
                            <div class="text-xl font-semibold" id="electron-flux">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg col-span-2">
                            <div class="text-gray-400">Last Updated</div>
                            <div class="text-xl font-semibold" id="solar-updated">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Band Conditions -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-broadcast-tower mr-2 section-icon icon-band"></i>Band Conditions
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">80m-40m</div>
                            <div class="text-xl font-semibold" id="band-80m-40m">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Day:</span>
                                    <span class="day-condition text-green-400">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-gray-400">Night:</span>
                                    <span class="night-condition text-blue-400">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">30m-20m</div>
                            <div class="text-xl font-semibold" id="band-30m-20m">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Day:</span>
                                    <span class="day-condition text-green-400">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-gray-400">Night:</span>
                                    <span class="night-condition text-blue-400">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">17m-15m</div>
                            <div class="text-xl font-semibold" id="band-17m-15m">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Day:</span>
                                    <span class="day-condition text-green-400">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-gray-400">Night:</span>
                                    <span class="night-condition text-blue-400">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">12m-10m</div>
                            <div class="text-xl font-semibold" id="band-12m-10m">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-400">Day:</span>
                                    <span class="day-condition text-green-400">Loading...</span>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-gray-400">Night:</span>
                                    <span class="night-condition text-blue-400">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Propagation Summary -->
            <div class="card rounded-lg p-6 lg:col-span-2">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-broadcast-tower mr-2 section-icon icon-propagation"></i>Propagation Summary
                </h2>
                <div id="propagation-summary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Time and Day/Night -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">Current Time</div>
                        <div class="text-xl font-semibold" id="current-time">Loading...</div>
                        <div class="text-sm text-gray-400" id="day-night">Loading...</div>
                        <div class="text-sm text-gray-400">Sunrise: <span id="sunrise">Loading...</span></div>
                        <div class="text-sm text-gray-400">Sunset: <span id="sunset">Loading...</span></div>
                    </div>

                    <!-- Solar Conditions -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">Solar Conditions</div>
                        <div class="space-y-1">
                            <div>SFI: <span id="sfi">Loading...</span></div>
                            <div>A-Index: <span id="a-index">Loading...</span></div>
                            <div>K-Index: <span id="k-index">Loading...</span></div>
                            <div>Aurora: <span id="aurora">Loading...</span></div>
                        </div>
                    </div>

                    <!-- MUF and Best Bands -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">MUF</div>
                        <div class="text-xl font-semibold" id="muf">Loading...</div>
                        <div class="text-gray-400 mt-2">Best Bands</div>
                        <div class="text-lg" id="best-bands">Loading...</div>
                    </div>

                    <!-- Propagation Quality -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">Overall Quality</div>
                        <div class="text-xl font-semibold" id="propagation-quality">Loading...</div>
                    </div>

                    <!-- Aurora Conditions -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">Aurora Conditions</div>
                        <div class="text-lg" id="aurora-conditions">Loading...</div>
                    </div>

                    <!-- Tropospheric Conditions -->
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="text-gray-400">Tropospheric Conditions</div>
                        <div class="text-lg" id="tropo-conditions">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- DXCC Conditions -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-globe-americas mr-2 section-icon icon-dxcc"></i>DXCC Conditions
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Name</div>
                            <div class="text-xl font-semibold" id="dxcc-name">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Continent</div>
                            <div class="text-xl font-semibold" id="dxcc-continent">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">ITU Zone</div>
                            <div class="text-xl font-semibold" id="dxcc-itu-zone">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">CQ Zone</div>
                            <div class="text-xl font-semibold" id="dxcc-cq-zone">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Prefixes</div>
                            <div class="text-xl font-semibold" id="dxcc-prefixes">Loading...</div>
                        </div>
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">Timezone</div>
                            <div class="text-xl font-semibold" id="dxcc-timezone">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Spots -->
            <div class="card rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <i class="fas fa-broadcast-tower mr-2 section-icon icon-spots"></i>Live Spots
                </h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <button onclick="querySpots()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh Spots
                        </button>
                        <div class="text-sm text-gray-400" id="spots-last-updated">Last updated: Never</div>
                    </div>
                    <div id="spots-container">
                        <!-- Band Statistics -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">Band Activity</h3>
                            <div id="band-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                        </div>
                        
                        <!-- Map Container -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-3">Spot Map</h3>
                            <div id="spots-map" class="h-96 bg-gray-800 rounded-lg"></div>
                        </div>

                        <!-- Spots List -->
                        <div>
                            <h3 class="text-lg font-semibold mb-3">Recent Spots</h3>
                            <div id="spots-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Initialize data with server-provided values
        const initialData = JSON.parse(document.getElementById('initial-data').textContent);
        let data = initialData;

        // Initialize map
        let spotsMap = null;
        let markers = [];

        function initMap() {
            if (spotsMap) {
                spotsMap.remove();
            }
            
            spotsMap = L.map('spots-map').setView([0, 0], 2);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(spotsMap);
        }

        // Function to update the page content
        function updateContent() {
            fetch('/api/conditions')
                .then(response => response.json())
                .then(newData => {
                    data = newData;
                    updateUI();
                })
                .catch(error => {
                    console.error('Error fetching conditions:', error);
                    document.getElementById('last-updated').textContent = 'Error updating data';
                });
        }

        // Function to update UI elements
        function updateUI() {
            if (data.error) {
                // Show error message
                document.getElementById('error-message').textContent = data.error;
                document.getElementById('error-message').style.display = 'block';
                return;
            }

            // Hide error message if it exists
            const errorElement = document.getElementById('error-message');
            if (errorElement) {
                errorElement.style.display = 'none';
            }

            // Update timestamp and location
            document.getElementById('timestamp').textContent = `Last Updated: ${data.timestamp}`;
            document.getElementById('location').textContent = `Location: ${data.location}`;

            // Update propagation summary
            const summary = data.propagation_summary;
            if (summary) {
                document.getElementById('current-time').textContent = summary.current_time;
                document.getElementById('day-night').textContent = summary.day_night;
                document.getElementById('sunrise').textContent = summary.sunrise;
                document.getElementById('sunset').textContent = summary.sunset;
                document.getElementById('muf').textContent = summary.muf;
                document.getElementById('best-bands').textContent = summary.best_bands.join(', ');
                document.getElementById('propagation-quality').textContent = summary.propagation_quality;
                document.getElementById('aurora-conditions').textContent = summary.aurora_conditions;
                document.getElementById('tropo-conditions').textContent = summary.tropo_conditions;

                // Update solar conditions from propagation summary
                if (summary.solar_conditions) {
                    document.getElementById('sfi').textContent = summary.solar_conditions.sfi;
                    document.getElementById('a-index').textContent = summary.solar_conditions.a_index;
                    document.getElementById('k-index').textContent = summary.solar_conditions.k_index;
                    document.getElementById('aurora').textContent = summary.solar_conditions.aurora;
                }
            }
            
            // Update weather conditions
            const weather = data.weather_conditions;
            if (weather) {
                document.getElementById('temperature').textContent = weather.temperature;
                document.getElementById('humidity').textContent = weather.humidity;
                document.getElementById('pressure').textContent = weather.pressure;
                document.getElementById('description').textContent = weather.description;
                document.getElementById('city').textContent = weather.city;
                document.getElementById('state').textContent = weather.state;
            }
            
            // Update solar conditions
            const solar = data.solar_conditions;
            if (solar) {
                document.getElementById('sfi').textContent = solar.sfi;
                document.getElementById('a-index').textContent = solar.a_index;
                document.getElementById('k-index').textContent = solar.k_index;
                document.getElementById('aurora').textContent = solar.aurora;
                document.getElementById('xray').textContent = solar.xray;
                document.getElementById('sunspots').textContent = solar.sunspots;
                document.getElementById('proton-flux').textContent = solar.proton_flux;
                document.getElementById('electron-flux').textContent = solar.electron_flux;
                document.getElementById('solar-updated').textContent = solar.updated;
            }

            // Update band conditions
            const bands = data.band_conditions;
            if (bands) {
                Object.entries(bands).forEach(([band, conditions]) => {
                    const element = document.getElementById(`band-${band}`);
                    if (element) {
                        const dayCondition = element.querySelector('.day-condition');
                        const nightCondition = element.querySelector('.night-condition');
                        
                        // Set day condition with color
                        dayCondition.textContent = conditions.day;
                        dayCondition.className = `day-condition ${getConditionColor(conditions.day)}`;
                        
                        // Set night condition with color
                        nightCondition.textContent = conditions.night;
                        nightCondition.className = `night-condition ${getConditionColor(conditions.night)}`;
                    }
                });
            }

            // Update DXCC conditions
            const dxcc = data.dxcc_conditions;
            if (dxcc && dxcc.current) {
                document.getElementById('dxcc-name').textContent = dxcc.current.name;
                document.getElementById('dxcc-continent').textContent = dxcc.current.continent;
                document.getElementById('dxcc-itu-zone').textContent = dxcc.current.itu_zone;
                document.getElementById('dxcc-cq-zone').textContent = dxcc.current.cq_zone;
                document.getElementById('dxcc-prefixes').textContent = dxcc.current.prefixes.join(', ');
                document.getElementById('dxcc-timezone').textContent = dxcc.current.timezone;
            }
            
            // Update last updated time
            document.getElementById('last-updated').textContent = new Date().toLocaleString();
        }

        // Function to get color class based on condition
        function getConditionColor(condition) {
            switch(condition.toLowerCase()) {
                case 'excellent':
                    return 'text-green-400';
                case 'good':
                    return 'text-green-300';
                case 'fair':
                    return 'text-yellow-400';
                case 'poor':
                    return 'text-red-400';
                default:
                    return 'text-gray-400';
            }
        }

        // Function to query spots
        function querySpots() {
            const spotsContainer = document.getElementById('spots-container');
            const spotsList = document.getElementById('spots-list');
            const bandStats = document.getElementById('band-stats');
            const spotsLastUpdated = document.getElementById('spots-last-updated');
            
            // Show loading state
            spotsList.innerHTML = '<div class="text-center py-4"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"></div><div class="mt-2 text-gray-400">Loading spots...</div></div>';
            bandStats.innerHTML = '';
            
            // Initialize map if not already done
            if (!spotsMap) {
                initMap();
            }
            
            fetch('/api/query_spots', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Received spots data:', data);
                
                // Clear existing markers
                markers.forEach(marker => marker.remove());
                markers = [];
                
                // Update band statistics
                const bandCounts = {};
                data.spots.forEach(spot => {
                    bandCounts[spot.band] = (bandCounts[spot.band] || 0) + 1;
                });
                
                bandStats.innerHTML = Object.entries(bandCounts)
                    .map(([band, count]) => `
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <div class="text-gray-400">${band}</div>
                            <div class="text-xl font-semibold">${count} spots</div>
                        </div>
                    `).join('');
                
                // Update spots list and map
                spotsList.innerHTML = '';
                if (data.spots && data.spots.length > 0) {
                    data.spots.forEach(spot => {
                        // Add spot to list
                        const spotElement = document.createElement('div');
                        spotElement.className = 'spot-item bg-gray-800 p-4 rounded-lg';
                        spotElement.innerHTML = `
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div>
                                    <div class="text-gray-400">Time</div>
                                    <div class="text-lg">${spot.timestamp}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Callsign</div>
                                    <div class="text-lg">${spot.callsign}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Frequency</div>
                                    <div class="text-lg">${spot.frequency} MHz</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Mode</div>
                                    <div class="text-lg">${spot.mode}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">Band</div>
                                    <div class="text-lg">${spot.band}</div>
                                </div>
                                <div>
                                    <div class="text-gray-400">DXCC</div>
                                    <div class="text-lg">${spot.dxcc}</div>
                                </div>
                                <div class="col-span-2">
                                    <div class="text-gray-400">Comment</div>
                                    <div class="text-lg">${spot.comment}</div>
                                </div>
                            </div>
                        `;
                        spotsList.appendChild(spotElement);

                        // Add spot to map if coordinates are available
                        if (spot.source_lat && spot.source_lon && spot.dest_lat && spot.dest_lon) {
                            // Add source marker
                            const sourceMarker = L.marker([spot.source_lat, spot.source_lon])
                                .bindPopup(`Source: ${spot.callsign}<br>Band: ${spot.band}<br>Mode: ${spot.mode}`);
                            sourceMarker.addTo(spotsMap);
                            markers.push(sourceMarker);

                            // Add destination marker
                            const destMarker = L.marker([spot.dest_lat, spot.dest_lon])
                                .bindPopup(`Destination: ${spot.dxcc}<br>Band: ${spot.band}<br>Mode: ${spot.mode}`);
                            destMarker.addTo(spotsMap);
                            markers.push(destMarker);

                            // Add line between points
                            const line = L.polyline([[spot.source_lat, spot.source_lon], [spot.dest_lat, spot.dest_lon]], {
                                color: getBandColor(spot.band),
                                weight: 2,
                                opacity: 0.7
                            }).addTo(spotsMap);
                            markers.push(line);
                        }
                    });

                    // Fit map to show all markers
                    if (markers.length > 0) {
                        const group = new L.featureGroup(markers);
                        spotsMap.fitBounds(group.getBounds().pad(0.1));
                    }
                } else {
                    spotsList.innerHTML = '<div class="text-center text-gray-400 py-4">No spots available</div>';
                }

                // Update last updated time
                spotsLastUpdated.textContent = `Last updated: ${new Date().toLocaleString()}`;
            })
            .catch(error => {
                console.error('Error fetching spots:', error);
                spotsList.innerHTML = '<div class="text-center text-red-500 py-4">Error loading spots: ' + error.message + '</div>';
                bandStats.innerHTML = '';
            });
        }

        // Function to get color based on band
        function getBandColor(band) {
            const colors = {
                '160m': '#FF0000',
                '80m': '#FF7F00',
                '40m': '#FFFF00',
                '30m': '#00FF00',
                '20m': '#0000FF',
                '17m': '#4B0082',
                '15m': '#9400D3',
                '12m': '#FF1493',
                '10m': '#00FFFF'
            };
            return colors[band] || '#FFFFFF';
        }

        // Initial spots query
        querySpots();

        // Update content every 5 minutes
        setInterval(updateContent, 5 * 60 * 1000);
        
        // Initial update
        updateUI();
    </script>
</body>
</html> 